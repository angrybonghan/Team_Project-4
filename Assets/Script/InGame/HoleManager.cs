using UnityEngine;

public class HoleManager : MonoBehaviour
{
    [Header("이 구멍의 애니메이션 프리팹")]
    public GameObject animationPrefabs;

    [Header("8볼 프리팹")]
    public GameObject eightBallPrefabs;

    private Rigidbody2D rb;


    private void OnTriggerEnter2D(Collider2D other)
    {
        switch (other.tag)
        {
            case "MergeBall":   // 이 구멍에 머지볼이 들어옴
                Destroy(other.gameObject);
                PlayAnimation(); // 애니메이션 실행 함수
                GameManager.scoredBallInChalk ++; //현재 초크에 들어간 공의 수를 늘리기
                displayBall.DisplayBallCount ++;
                break;
            case "PlayerBall":  // 플레이어 공이 구멍에 들어가면 그냥 저멀리 보내버림
                GameManager.attemptsLeft--; // 플레이어 공이 들어갈 시 남은 초크 --
                GameManager.attemptsText.text = GameManager.attemptsLeft.ToString(); // 텍스트 UI 업데이트
                rb = other.GetComponent<Rigidbody2D>();
                other.transform.position = new Vector2(999999, 999999);
                rb.velocity = Vector2.zero;

                PlayAnimation();
                break;
            case "8Ball":
                PlayAnimation();
                Destroy(other.gameObject);

                if (GameManager.isBallEight)
                {
                    GameManager.isGameWin = true;
                }
                else
                {
                    GameManager.isGameOver = true;
                }
                break;

            case "OB_Level_Up": //레벨 업 볼
                Destroy(other.gameObject);
                PlayAnimation(); // 애니메이션 실행
                GameManager.scoredBallInChalk += 2; //현재 초크에 들어간 공의 수를 두개 늘리기
                displayBall.DisplayBallCount += 2;
                break;

            case "OB_Level_Down":   //레벨 다운 볼
                Destroy(other.gameObject);
                PlayAnimation(); // 애니메이션 실행
                if (GameManager.ballNumber >= 2)    // 공 레벨이 0 아래로 내려가지는 않음
                {
                    GameManager.ballNumber -= 2;    // 전체 공 레벨을 2 내린다
                    GameManager.scoredBallInChalk++;    // 초크에 공을 하나 넣은 판정을 준다 (공 업데이트를 시키기 위함)
                    // 고로 -2 + 1 = -1
                    // 최종적으로 1만 빠짐
                }
                break;

            case "OB_Copy":
                PlayAnimation(); // 애니메이션 실행

                for (int i = 0; i < 2; i++)
                {
                    Vector3 CopyPos = new Vector3
                        (
                        UnityEngine.Random.Range(-1f, 1f),
                        UnityEngine.Random.Range(-1f, 1f),
                        0
                        );
                    GameObject EightBall = Instantiate(eightBallPrefabs, CopyPos, transform.rotation);
                }
                Destroy(other.gameObject);
                break;

            default:
                Debug.LogError("[???] 태그가 뭣도 아닌 것이 구멍에 들어옴");
                break;
        }
    }

    void PlayAnimation()
    {
        GameObject Animation = Instantiate(animationPrefabs, transform.position, transform.rotation);
    }
}
